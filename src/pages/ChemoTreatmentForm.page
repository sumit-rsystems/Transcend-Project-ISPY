<apex:page StandardController="Chemo_Treatment__c" extensions="ChemoTreatmentFormController" sideBar="false" id="pageId" action="{!saveMainCRF}" tabStyle="Patient_Custom__c">
<script type="text/javascript">
    function addYearInDateField(relatedYearShow) {
        //alert(document.getElementById('datePicker').innerHTML);
         var currentYear = new Date().getFullYear();
         var startYear;
         var endYear;
         
         if(relatedYearShow == 'past'){
             startYear= 1900;
             endYear=currentYear;
         }else if(relatedYearShow == 'future'){
            startYear= currentYear;
            endYear= currentYear + 30;
         }else{
             startYear= 1950;
             endYear=currentYear + 20;
         }
         
         var htmlStr='';
         if(startYear<endYear){
            for(i=startYear;i<endYear+1;i++){
                if(i == currentYear) {
                    htmlStr += "<option value=\""+i+"\" selected=\"selected\">"+i+"</option>";
                } else {
                    htmlStr += "<option value=\""+i+"\">"+i+"</option>";
                }
            }
        }
        //alert(htmlStr);
        document.getElementById('calYearPicker').innerHTML = htmlStr; 
    }
</script>

<style>
    .mystyle
    {
        background-color: #cf00f8;
    }
    
    .activeTab {
        background: none repeat scroll 0 0 #FFFFFF;
        border-bottom: 2px solid #FFFFFF;
        color: #000000;
        font-weight: 600;
        width: 180px;
    }
    
    .inactiveTab {
      cursor: pointer;
      background:#2e84c5 url({!$Resource.Tabmenubg}) left top repeat-x;
      color: white; /*#3C3C3C;*/
      font-weight: bold;
      font-size: 12px;
      height: 15px;
      width: 180px;
      vertical-align: middle;
      border: none;
    }
     
    .rich-tab-inactive {
     background-repeat: repeat-x;
     border-color: #FFFFFF;
     border-style: none;
     border-width: 0;
     cursor: pointer;
    }
    
    .rich-tabhdr-side-border {
     background-image:none; 
     border-radius: 4px 4px 0 0;
     background-color: none;
     width: 2px;
    }
    
    .rich-tabhdr-side-cell {
     box-shadow: 0 -2px 2px #A7A7A8;
     border-top: 2px solid #056FC1;
     border-left: 2px solid #056FC1;
     border-right: 2px solid #056FC1;
     border-radius: 4px 4px 0 0;
    }
    
    .rich-tabpanel-content {
     background-color: #fff;
     border-left: 2px solid #056FC1;
     border-right: 2px solid #056FC1;
     border-bottom: 2px solid #056FC1;
    }
    
    .rich-tab-bottom-line {
     border-bottom: 1px solid #056FC1;
    }
    
    .accountTab .tertiaryPalette, .individualPalette .accountBlock .tertiaryPalette, .layoutEdit .individualPalette .accountBlock .tertiaryPalette {
     background-color: #97C7EC;
    }
    
    body .bPageBlock, body #bodyCell .bResource .secondaryPalette, body .secondaryPalette.bPageBlock, body .individualPalette .secondaryPalette.bPageBlock, body .bodyDiv .genericTable, body .genericPageBlockTable, body .bodyDiv .bSubBlock, body .bComponentBlock .bPageBlock, body .bMyDashboard .bPageBlock, body.rlHoverFrame .bPageBlock, body.subjectSelectionPopup div.choicesBox, body.lookupTab .secondaryPalette.bPageBlock, body.popupTab .secondaryPalette.bPageBlock, body.UserTagStatsPage .secondaryPalette.bPageBlock {
     background-color: #fff;
    }
    .name {
        font-size: 1.50em;
        font-weight: bold;
    }
    .selectbox{
        background-color: #2F96E4;
        font-family: Arial, sans-serif;
        font-size: 12px;
        font-weight: normal;
        height: 25px;
        position: relative;
        width: 152px;
        border:1px solid #adaeae; -moz-border-radius: 6px; -webkit-border-radius:6px; -khtml-border-radius: 6px; border-radius:6px;
        color:#fff;
        font-size:12px; font-weight: bold;
        padding:3px 0 3px 10px;
    }
</style>
    <script>
        function enableGrowthFactorsDetails(obj) {
            //alert(obj.checked); 
            parentObj = obj.parentNode.parentNode;
            var inputObjects = parentObj.getElementsByTagName('input');
            var selectObjects = parentObj.getElementsByTagName('select');
            for(var i=1;i<inputObjects.length;i++) {
                if(obj.checked) {
                    inputObjects[i].disabled = false;
                } else {
                    inputObjects[i].disabled = true;
                }
            }
            for(var i=0;i<selectObjects.length;i++) {
                if(obj.checked) {
                    selectObjects[i].disabled = false;
                } else {
                    selectObjects[i].disabled = true;
                }
            }
            
        }
        
        function enableAgentRow(obj) {
            parentObj = obj.parentNode.parentNode;
            var tdList = parentObj.getElementsByTagName('td');
            //var inputFields = parentObj.getElementsByTagName('input');
            //var selectFields = parentObj.getElementsByTagName('select');
            for(var j=1; j<tdList.length;j++) {
                if(j<=6) {
                    tdInputFields = tdList[j].getElementsByTagName('input');
                    tdSelectFields = tdList[j].getElementsByTagName('select');
                    //alert(tdInputFields.length+'    '+tdSelectFields.length);
                    for(var i=0;i<tdInputFields.length;i++) {
                        if(obj.checked) {
                            tdInputFields[i].disabled = false;
                        } else {
                            tdInputFields[i].disabled = true;
                        }
                    }
                    for(var i=0;i<tdSelectFields.length;i++) {
                        if(obj.checked) {
                            tdSelectFields[i].disabled = false;
                        } else {
                            tdSelectFields[i].disabled = true;
                        }
                    }
                }
            }
        }
        
        function showOtherField(obj) {
            //alert(obj.value);
            parentObj = obj.parentNode;
            var inputFields = parentObj.getElementsByTagName('input');
            for(var i=0;i<inputFields.length;i++) {
                if(obj.value == 'Other') {
                    inputFields[i].style.display = 'block';
                } else {
                    inputFields[i].style.display = 'none';
                }
            }
        }
        
        function cancelConfirm() {
            if(confirm('Completely Cancel and Remove?')) {
                return true;
            } else {
                return false;
            }
        }
        
        function checkDelete() {
            if(confirm('Are you sure you want to Delete this form?')) {
                return true;
            } else {
                return false;
            }
        }
        
        function changeMedType(obj) {
            if(obj.value == 'Other') {
                parentObj = obj.parentNode.parentNode;
                var likeString = parentObj.getElementsByTagName('span');
                for(var i=0;i<likeString.length;i++) {
                    if(likeString[i].id.indexOf('medPanel1') != -1) {
                        likeString[i].style.display = 'none';   
                    }
                    if(likeString[i].id.indexOf('medPanel2') != -1) {
                        likeString[i].style.display = 'block';  
                    }
                } 
            } else {
                parentObj = obj.parentNode.parentNode;
                var likeString = parentObj.getElementsByTagName('span');
                for(var i=0;i<likeString.length;i++) {
                    if(likeString[i].id.indexOf('medPanel1') != -1) {
                        likeString[i].style.display = 'block';  
                    }
                    if(likeString[i].id.indexOf('medPanel2') != -1) {
                        likeString[i].style.display = 'none';   
                    }
                } 
            }       
        }
        
        function enableReasonStopRes(obj) {
            parentObj = obj.parentNode.parentNode;
            var selectFields = parentObj.getElementsByTagName('select');
            for(var i=0;i<selectFields.length;i++) {
                if(i==3) {
                    if(obj.checked) {
                        selectFields[i].disabled = false;
                    } else {
                        selectFields[i].disabled = true;
                    }
                }
            }
        }
        
        function enableOtherReason(obj, fieldObj) {
            //alert(obj.value+' field id : '+fieldObj.id);
            //parentObj = obj.parentNode;
            //var inputFields = parentObj.getElementsByTagName('input');
            //for(var i=0;i<inputFields.length;i++) {
            for (i = 0; i < obj.options.length; i++) {
                if(obj.options[i].value == "Other") {
                    fieldObj.style.display = 'Block';
                    break;
                } else {
                    fieldObj.style.display = 'none;';
                }
            }
                
            //}
        }
        
        function enableAgents(obj) {
            //alert('obj.value : '+obj.value);
            /*var tableFields = document.getElementById('agentTable');
            var inputFields = tableFields.getElementsByTagName('input');
            for(var i=0;i<inputFields.length;i++) {
                if(inputFields[i].id.indexOf('isAgentCheckedId') != -1) {
                    if(obj.value == 'false') {
                        inputFields[i].disabled = true;
                        inputFields[i].checked = false;
                        parObj = inputFields[i].parentNode.parentNode;
                        var infield = parObj.getElementsByTagName('input');
                        var slfield = parObj.getElementsByTagName('select');
                        for(var j=0;j<infield.length;j++) {
                            infield[j].disabled = true;
                        }
                        for(var k=0;k<slfield.length;k++) {
                            slfield[k].disabled = true;
                        }
                    }
                    else {
                        inputFields[i].disabled = false;
                    }
                }
            }
            if(obj.value == 'false') {
                document.getElementById('pageId:formId:chemoAdminId:addAgentId').style.display = 'none';
            }
            else if(obj.value == 'true') {
                document.getElementById('pageId:formId:chemoAdminId:addAgentId').style.display = 'block';
            }*/
        }
        
        function startSplash() {
            var divObj = document.getElementById('splashDiv');
            var msgSplash =document.getElementById('waitMsg');
            var browserName = navigator.appName;
            if(browserName == 'Netscape'){
                divObj.style.display='table-cell'; 
            } else {
                divObj.style.display='table-cell';
            }
       }
        function endSplash() {            
            document.getElementById('splashDiv').style.display='none';
        }
    </script>
    <div id="splashDiv" style="display: none;width:100%;height:100%;background-color: #000;z-index: 1; position: absolute;opacity:0.5;">
        <div style="text-align: center; top: 50%;width:100%;height:100%;position: fixed;" class="circle"><apex:image value="{!$Resource.LoadingImg1}"></apex:image></div>
    </div> 
    <span class ="name">Patient's Details</span>
    <br/>
        <c:PatientDetailReadOnly patientId="{!trialPatientObj.Patient_Id__c}"/>
    <br/>
    
    <table width="100%">
        <tr>
            <td width="40%" align="left">
                <span class ="name">Chemo Treatment Form</span>
            </td>
            <td width="60%" align="left">
                <apex:outputText style="font-weight: bold; color:#fff; padding-right:7px;" styleClass="selectbox" id="trialName" value="Trial: {!trialPatientObj.Trial_Id__r.Name}" />
            </td>
        </tr>
    </table>
    <apex:pageMessages id="errMsg"/>
    <apex:form id="formId">
        <apex:pageBlock tabStyle="Account" helpTitle="Help"  helpUrl="/apex/ChemoTreatmentformUserGuide" rendered="{!isComplete}"> 
            <apex:pageBlockButtons location="top" >
                <apex:commandButton action="{!next}" value="Save & Close" reRender="theTabPanel,errMsg" status="splashStatus">
                    <apex:param name="nextTab" value="saveAndClose"/>
                </apex:commandButton>
                <apex:commandButton action="{!cancelCRF}" value="  Cancel  " onClick="return cancelConfirm();" immediate="true"/>
            </apex:pageBlockButtons>
        </apex:pageBlock> 
        <apex:pageBlock rendered="{!isDelete}">
          <apex:pageBlockButtons location="top" >
                <apex:commandButton action="{!cancelCRF}" value="Delete" onClick="return checkDelete();" immediate="true" rendered="{!profileName =='System Administrator'}"/>
                <!-- apex:commandButton value="Generate Pdf" action="{!redirect}" rendered="{!chemoTreatmentWrapper.chemoTreatment.Status__c == 'Accepted'}"/> -->
                <apex:commandLink style="text-decoration:none;" value="Generate Pdf" target="_blank" styleClass="btn" action="{!redirect}" rendered="{!chemoTreatmentWrapper.chemoTreatment.Status__c == 'Accepted'}"/>
          </apex:pageBlockButtons>
    </apex:pageBlock> 
        <apex:actionFunction name="next" action="{!next}"  rerender="theTabPanel,errMsg" status="splashStatus"/>
            <apex:inputHidden value="{!nextTabName}" id="nextTabNameID"/> 
        <apex:actionStatus id="splashStatus" onstart="startSplash();" onstop="endSplash(); " /> 
        <apex:outputPanel >
        <script>
            function enterToNextTab(val){
                //alert(val);
                if('{!isComplete}' != 'false'){
                    document.getElementById('pageId:formId:nextTabNameID').value = val;
                    next();
                }
            }
        </script>
        </apex:outputPanel>
        <apex:tabPanel switchType="client" value="{!currentTab}" id="theTabPanel" inactiveTabClass="inactiveTab" activeTabClass="activeTab" contentStyle="font-size: 12px;">
            <apex:tab label="Chemo Administration" name="chemoAdminTab" id="chemoAdminTabId" ontabenter="enterToNextTab('chemoAdminTab');" rendered="{!isComplete}" >
                
                <apex:pageBlock id="chemoAdminId" tabStyle="Account">
                    <apex:pageBlockButtons location="top">
<!--                        <apex:commandButton action="{!cancelCRF}" value="  Cancel  " onClick="return cancelConfirm();" immediate="true"/>-->
                        <apex:commandButton action="{!next}" value="  Next  " reRender="theTabPanel,errMsg" status="splashStatus">
                            <apex:param name="nextTab" value="growthFactorsTab"/>
                        </apex:commandButton>
                        <apex:actionStatus id="tabChangeStatus" startText="Processing..."/>
                    </apex:pageBlockButtons>
                    <table>
                        <tr>
                            <td>Date of therapy&nbsp;</td>
                            <td><apex:inputField value="{!chemoTreatmentWrapper.chemoTreatment.Date_of_therapy__c}"  id="chemoTreatementDateOfTeraph"/>
                                <script type="text/javascript">
                                    document.getElementById('{!$component.chemoTreatementDateOfTeraph}').onfocus = function onfocus(event) {
                                    DatePicker.pickDate(true, '{!$component.chemoTreatementDateOfTeraph}', false); 
                                    addYearInDateField('past'); 
                                };
                                </script>
                            </td>
                            <td></td>
                            <td>[<apex:outputLabel value="{!treatmentArm}" />]</td> 
                        </tr>
                        <tr>
                            <td>Cycle number&nbsp;</td>
                            <td><apex:inputField value="{!chemoTreatmentWrapper.chemoTreatment.Cycle_number__c}" />
                                </td>
                            <td>Did patient go off study treatment?</td>
                            <td>
                                <!--<apex:selectRadio id="studyTreatmentId" value="{!chemoTreatmentWrapper.chemoTreatment.Did_patient_go_off_study_treatment__c}" onChange="enableAgents(this);">
                                    <apex:selectOptions value="{!studyTreatmentOptions}" /> 
                                </apex:selectRadio>
                            -->
                                <apex:selectRadio id="studyTreatmentId" value="{!chemoTreatmentWrapper.chemoTreatment.Did_patient_go_off_study_treatment__c}" onChange="enableAgents(this);">
                                    <apex:selectOptions value="{!studyTreatmentOptions}" /> 
                                </apex:selectRadio>
                            </td>
                        </tr>
                        <tr>
                            <td>Patient's weight&nbsp;</td>
                            <td><apex:inputField value="{!chemoTreatmentWrapper.chemoTreatment.Patient_weight__c}" />kg</td>
                        </tr>
                        <tr>
                            <td>Patient's height&nbsp;</td>
                            <td><apex:inputField value="{!chemoTreatmentWrapper.chemoTreatment.Patient_height__c}" />cm</td>
                        </tr>
                    </table>
                    <div style="width: 1200px; height:400px; overflow-x: scroll; overflow-y: scroll;" id="agentDivId">
                        <table id="agentTable" width="1500px">
                            <tr>
                                <th width="20%">Agent Name</th>
                                <th width="20%">Prescribed Dose</th>
                                <th width="10%">Total Dose Administered</th>
                                <th width="10%">Day#</th>
                                <th width="10%">Dose delay?</th>
                                <th width="10%">Dose mod (+/-)</th>
                                <th width="15%">Dose mod. Reason</th>
                                <th width="5%">Did patient stop receiving?</th>
                                <th width="15%">Reason why patient stopped receiving</th>
                            </tr>
                            <tr>
                                <td><hr /></td>
                                <td><hr /></td>
                                <td><hr /></td>
                                <td><hr /></td>
                                <td><hr /></td>
                                <td><hr /></td>
                                <td><hr /></td>
                                <td><hr /></td>
                                <td><hr /></td>
                            </tr>
                            <apex:repeat value="{!chemoTreatmentWrapper.lstChemoTherapyWrapper}" var="chemoTherapyWrapper">
                                <tr>
                                    <td valign="top">
                                        <apex:inputCheckbox value="{!chemoTherapyWrapper.isAgentChecked}" id="isAgentCheckedId">
                                            <apex:actionSupport action="{!executeChemoTherapyRule}" event="onchange" reRender="chemoAdminId" status="changeStatus">
                                                <apex:param value="{!chemoTherapyWrapper.agentName}" name="agentName" />
                                                <apex:param value="{!chemoTherapyWrapper.isAgentChecked}" name="isAgentChecked" /> 
                                                 <apex:param value="{!chemoTherapyWrapper.index}" name="index" /> 
                                            </apex:actionSupport>
                                        </apex:inputCheckbox>
                                        <apex:outputText value="{!chemoTherapyWrapper.agentName}" rendered="{!IF(chemoTherapyWrapper.isOtherAgent == false, true, false)}"/>
                                        <apex:inputText value="{!chemoTherapyWrapper.chemoTherapy.Other_Agent__c}" rendered="{!chemoTherapyWrapper.isOtherAgent}"/>
                                        <br />
                                        <apex:actionStatus id="changeStatus" startText="Processing..."/>
                                        <script>
                                            if("{!chemoTreatmentWrapper.chemoTreatment.Did_patient_go_off_study_treatment__c}" == "true" || "{!chemoTreatmentWrapper.chemoTreatment.Did_patient_go_off_study_treatment__c}" == "false") {
                                                //alert('false');
                                                document.getElementById('{!$Component.isAgentCheckedId}').disabled = false;
                                                if("{!chemoTherapyWrapper.isDisabled}" == "true") {
                                                    document.getElementById('{!$Component.isAgentCheckedId}').disabled = true;
                                                } else {
                                                    document.getElementById('{!$Component.isAgentCheckedId}').disabled = false;
                                                }
                                            } else {
                                                //alert('true');
                                                document.getElementById('{!$Component.isAgentCheckedId}').disabled = true;
                                            }
                                            
                                            
                                            
                                            
                                        </script>
                                    </td>
                                    <td valign="top">
                                        <apex:inputField value="{!chemoTherapyWrapper.chemoTherapy.Prescribed_Dose__c}" id="doseId" style="width: 30%;"/>
                                        &nbsp;{!chemoTherapyWrapper.doseUnit}
                                        <apex:inputField value="{!chemoTherapyWrapper.chemoTherapy.Prescribed_dose_Units__c}" id="otherdoseId" rendered="{!chemoTherapyWrapper.isOtherAgent}"/>
                                    </td>
                                    <td valign="top">
                                        <apex:inputField value="{!chemoTherapyWrapper.chemoTherapy.Total_Dose__c}" id="totalDoseId" style="width: 30%;"/>
                                        &nbsp;{!chemoTherapyWrapper.totalDoseUnit}
                                        <apex:inputField value="{!chemoTherapyWrapper.chemoTherapy.Administered_dose_Units__c}" id="otherAdmindoseId" style="width: 50%;" rendered="{!chemoTherapyWrapper.isOtherAgent}"/>
                                    </td>
                                    <td valign="top"><apex:inputField value="{!chemoTherapyWrapper.chemoTherapy.Day__c}" id="dayId" style="width: 50%;"/></td>
                                    <td valign="top"><apex:inputField value="{!chemoTherapyWrapper.chemoTherapy.Dose_Delay__c}" id="doseDelayId" style="width: 80%;"/></td>
                                    <td valign="top"><apex:inputField value="{!chemoTherapyWrapper.chemoTherapy.Dose_Mod__c}" rendered="{!IF(chemoTherapyWrapper.isOtherAgent, false, true)}" id="doseModId" style="width: 50%;"/>
                                        &nbsp;<apex:outputLabel rendered="{!IF(chemoTherapyWrapper.isOtherAgent, false, true)}" value="%" /></td>
                                    <td valign="top">
                                        <apex:inputField value="{!chemoTherapyWrapper.chemoTherapy.Dose_modification__c}" rendered="{!IF(chemoTherapyWrapper.isOtherAgent, false, true)}" id="doseModReasonId" onChange="showOtherField(this);"/>
                                        <apex:inputField value="{!chemoTherapyWrapper.chemoTherapy.Other_Dose_Mod_Reason__c}" rendered="{!IF(chemoTherapyWrapper.isOtherAgent, false, true)}" id="otherDoseModReasonId" />
                                    </td>
                                    <td valign="top">
                                        <apex:inputField value="{!chemoTherapyWrapper.chemoTherapy.Did_patient_stop_receiving__c}" rendered="{!IF(chemoTherapyWrapper.isOtherAgent, false, true)}" id="stopResId" onChange="enableReasonStopRes(this);" />
                                    </td>
                                    <td valign="top">
                                        <apex:inputField value="{!chemoTherapyWrapper.chemoTherapy.Reason_why_patient_stopped_receiving__c}" rendered="{!IF(chemoTherapyWrapper.isOtherAgent, false, true)}" id="reasonStopResId" onChange="enableOtherReason(this, document.getElementById('{!$Component.otherReasonStopResId}'));"/>
                                        <apex:inputField value="{!chemoTherapyWrapper.chemoTherapy.Other_Reason_Patient_Stop_Receiving__c}" rendered="{!IF(chemoTherapyWrapper.isOtherAgent, false, true)}" id="otherReasonStopResId" style="display: none;"/>
                                        
                                        <script>
                                            document.getElementById('{!$Component.doseId}').disabled = {!(IF(chemoTherapyWrapper.isAgentChecked = true,false,true))};
                                            document.getElementById('{!$Component.totalDoseId}').disabled = {!(IF(chemoTherapyWrapper.isAgentChecked = true,false,true))};
                                            document.getElementById('{!$Component.dayId}').disabled = {!(IF(chemoTherapyWrapper.isAgentChecked = true,false,true))};
                                            document.getElementById('{!$Component.doseDelayId}').disabled = {!(IF(chemoTherapyWrapper.isAgentChecked = true,false,true))};
                                            document.getElementById('{!$Component.doseModId}').disabled = {!(IF(chemoTherapyWrapper.isAgentChecked = true,false,true))};
                                            document.getElementById('{!$Component.doseModReasonId}').disabled = {!(IF(chemoTherapyWrapper.isAgentChecked = true,false,true))};
                                            document.getElementById('{!$Component.otherDoseModReasonId}').style.display = 'none';
                                            if("{!chemoTherapyWrapper.isOtherAgent}" == "false") {
                                                enableReasonStopRes(document.getElementById('{!$Component.stopResId}'));
                                            }
                                        </script>
                                    </td>
                                </tr>
                            </apex:repeat> 
                        </table>
                    </div>
                    <apex:actionRegion id="actionRegionId1">
                        <apex:commandLink value="Add more agents" action="{!addOtherAgent}" style="color: blue;" rerender="theTabPanel" status="addAgent" id="addAgentId" />
                        <script>
                            /*if("{!chemoTreatmentWrapper.chemoTreatment.Did_patient_go_off_study_treatment__c}" == "true") {
                                document.getElementById('{!$Component.addAgentId}').style.display = 'block';
                            } else {
                                document.getElementById('{!$Component.addAgentId}').style.display = 'none';
                            }*/
                        </script>
                    <apex:actionStatus id="addAgent" startText="Processing..."/>
                    </apex:actionRegion>
                </apex:pageBlock>
            </apex:tab>
            <apex:tab label="Growth Factors" name="growthFactorsTab" id="growthFactorsTabId" ontabenter="enterToNextTab('growthFactorsTab');" rendered="{!isComplete}">
                <apex:pageBlock title="Growth Factors (for this cycle)" tabStyle="Account">
                    <apex:pageBlockButtons location="top">
<!--                        <apex:commandButton action="{!cancelCRF}" value="  Cancel  " onClick="return cancelConfirm();" immediate="true"/>-->
                        <apex:commandButton action="{!previous}" value=" Previous " reRender="theTabPanel, chemoAdminTabId, growthFactorsTabId, conMedTab" status="splashStatus"/> 
                        <apex:commandButton action="{!next}" value="  Next  " reRender="theTabPanel" status="splashStatus">
                            <apex:param name="nextTab" value="conMedTab"/>
                        </apex:commandButton>
                    <apex:actionStatus id="tabChangeStatus" startText="Processing..."/>
                    </apex:pageBlockButtons>
                    <table width="100%">
                        <tr>
                            <th width="1%"></th>
                            <th width="10%">Drug Name</th>
                            <th width="10%">Prescribed Dose</th>
                            <th width="10%">Total Dose Administered</th>
                            <th width="10%">Route</th>
                            <th width="39%">Notes</th>
                        </tr>
                        <tr>
                            <td><hr /></td>
                            <td><hr /></td>
                            <td><hr /></td>
                            <td><hr /></td>
                            <td><hr /></td>
                            <td><hr /></td>
                        </tr>
                        <apex:repeat value="{!chemoTreatmentWrapper.lstGrowthFactor}" var="growthFactor">
                            <tr>
                                <td><apex:inputCheckbox value="{!growthFactor.isReceived__c}" id="isReceivedId" onChange="enableGrowthFactorsDetails(this);" /></td>
                                <td><apex:outputField value="{!growthFactor.Name}" id="drugNameId" /></td>
                                <td><apex:inputField value="{!growthFactor.Dose__c}" style="width: 30%;" id="doseId"/>&nbsp;<apex:outputLabel value="{!IF(growthFactor.Name == 'Neupogen', 'mcg', 'mg')}" /></td>
                                <td><apex:inputField value="{!growthFactor.TotalDose__c}" style="width: 30%;" id="totalDoseId" />&nbsp;mg</td>
                                <td><apex:inputField value="{!growthFactor.Route__c}" id="routeId"/></td>
                                <td><apex:inputField value="{!growthFactor.Notes__c}" id="notesId"/>
                                    <script>
                                        //alert(('{!growthFactor.isReceived__c}' == 'false'));
                                        if('{!growthFactor.isReceived__c}' == 'false') {
                                            document.getElementById('{!$Component.isReceivedId}').checked = false;
                                            document.getElementById('{!$Component.doseId}').disabled = true;
                                            document.getElementById('{!$Component.totalDoseId}').disabled = true;
                                            document.getElementById('{!$Component.routeId}').disabled = true;
                                            document.getElementById('{!$Component.notesId}').disabled = true;
                                        } else {
                                            document.getElementById('{!$Component.isReceivedId}').checked = true;
                                            document.getElementById('{!$Component.doseId}').disabled = false;
                                            document.getElementById('{!$Component.totalDoseId}').disabled = false;
                                            document.getElementById('{!$Component.routeId}').disabled = false;
                                            document.getElementById('{!$Component.notesId}').disabled = false;
                                        }
                                        if('{!growthFactor.Dose__c}' != '') {
                                            document.getElementById('{!$Component.isReceivedId}').checked = true;
                                            document.getElementById('{!$Component.doseId}').disabled = false;
                                            document.getElementById('{!$Component.totalDoseId}').disabled = false;
                                            document.getElementById('{!$Component.routeId}').disabled = false;
                                            document.getElementById('{!$Component.notesId}').disabled = false;
                                        } else {
                                            document.getElementById('{!$Component.isReceivedId}').checked = false;
                                            document.getElementById('{!$Component.doseId}').disabled = true;
                                            document.getElementById('{!$Component.totalDoseId}').disabled = true;
                                            document.getElementById('{!$Component.routeId}').disabled = true;
                                            document.getElementById('{!$Component.notesId}').disabled = true;
                                        }
                                    </script>
                                </td>
                            </tr>
                        </apex:repeat>
                    </table>                
                </apex:pageBlock>
            </apex:tab>
            <apex:tab label="Concomitant Medications" name="conMedTab" id="conMedTabId" ontabenter="enterToNextTab('conMedTab');" rendered="{!isComplete}" >
                <apex:pageBlock title="Concomitant Medications" tabStyle="Account">
                    <apex:pageBlockButtons location="top">
<!--                        <apex:commandButton action="{!cancelCRF}" value="  Cancel  " onClick="return cancelConfirm();" immediate="true"/>-->
                        <apex:commandButton action="{!previous}" value=" Previous " reRender="theTabPanel, chemoAdminTabId" status="splashStatus"/>
                        <apex:commandButton action="{!next}" value="  Next  " reRender="theTabPanel" status="splashStatus">
                            <apex:param name="nextTab" value="attachmentTab"/>
                        </apex:commandButton> 
                        <apex:actionStatus id="tabChangeStatus" startText="Processing..."/>
                    </apex:pageBlockButtons>
                    <apex:pageBlockSection title="Concomitant Medications" id="medicationSection" columns="1">
                    <apex:actionRegion >
                            <apex:pageBlockTable value="{!chemoTreatmentWrapper.lstMedicationWrapper}" var="medicationWrapper" id="medicationTableId" width="100%">
                                <apex:column headerClass="tableHead ActionHead" style="vertical-align: top; padding-top: 15px;">
                                    <apex:facet name="header">Action</apex:facet>
                                    
                                    <apex:outputPanel rendered="{!IF(medicationWrapper.isReadOnly == true, false, true)}">
                                        <apex:commandLink action="{!cancelMedication}" immediate="true" value="Cancel" style="color: blue;" reRender="medicationSection" status="processingStatus">
                                            <apex:param name="recordId" value="{!medicationWrapper.concomitantMedication.Id}"/>
                                            <apex:param name="cancelIndex" value="{!medicationWrapper.sno}"/>
                                        </apex:commandLink>
                                        <apex:outputPanel rendered="{!medicationWrapper.isUpdateVisible}">&nbsp;|&nbsp;</apex:outputPanel>
                                        <apex:commandLink action="{!updateMedication}" value="Update" style="color: blue;" rendered="{!medicationWrapper.isUpdateVisible}" reRender="medicationSection, cconMedTabId" status="processingStatus">
                                            <apex:param name="recordId" value="{!medicationWrapper.concomitantMedication.Id}"/>
                                        </apex:commandLink>
                                    </apex:outputPanel>
                                    <apex:outputPanel rendered="{!medicationWrapper.isReadOnly}">
                                        <apex:commandLink action="{!editMedication}" value="Edit" style="color: blue;" reRender="medicationSection" status="processingStatus">
                                            <apex:param name="recordId" value="{!medicationWrapper.concomitantMedication.Id}"/>
                                        </apex:commandLink>
                                        &nbsp;|&nbsp;
                                        <apex:commandLink action="{!removeMedication}" value="Remove" style="color: blue;" reRender="medicationSection" status="processingStatus">
                                            <apex:param name="cancelIndex" value="{!medicationWrapper.sno}"/>
                                            <apex:param name="recordId" value="{!medicationWrapper.concomitantMedication.Id}"/>
                                        </apex:commandLink>
                                    </apex:outputPanel>
                                </apex:column>
                                <apex:column headerClass="tableHead TypeHead" style="vertical-align: top; padding-top: 15px;">
                                    <apex:facet name="header">Type</apex:facet>
                                    <apex:inputField value="{!medicationWrapper.concomitantMedication.Type__c}" rendered="{!IF(medicationWrapper.isReadOnly == true, false, true)}" id="typeId" onChange="changeMedType(this);"/>
                                    <apex:outputField value="{!medicationWrapper.concomitantMedication.Type__c}" rendered="{!medicationWrapper.isReadOnly}"/>
                                </apex:column>
                                <apex:column headerClass="tableHead NameHead" style="vertical-align: top; padding-top: 15px;">
                                    <apex:facet name="header">Medication</apex:facet>
                                    <apex:outputPanel id="medPanel1">
                                        <apex:inputField value="{!medicationWrapper.concomitantMedication.Medication__c}" rendered="{!IF(medicationWrapper.isReadOnly == true, false, true)}" id="medicationId"/>
                                        <apex:outputField value="{!medicationWrapper.concomitantMedication.Medication__r.Name}" rendered="{!medicationWrapper.isReadOnly}" id="readMedicationId"/>
                                    </apex:outputPanel>
                                    
                                    <apex:outputPanel id="medPanel2" style="display: none;">
                                        <apex:inputField value="{!medicationWrapper.concomitantMedication.Other_Madication__c}" rendered="{!IF(medicationWrapper.isReadOnly == true, false, true)}" id="otherMedId"/>
                                        <apex:outputField value="{!medicationWrapper.concomitantMedication.Other_Madication__c}" rendered="{!IF(AND(medicationWrapper.isReadOnly,medicationWrapper.isOtherMedication)  == true, true, false)}" id="readOtherMedId"/>
                                    </apex:outputPanel>
                                    
                                    <script>
                                        //alert('Medication__r.Name= {!medicationWrapper.concomitantMedication.Medication__r.Name}');
                                        //alert('isOtherMedication= {!medicationWrapper.isOtherMedication}');
                                        if('{!medicationWrapper.isOtherMedication}' == 'true') {
                                            document.getElementById('{!$Component.medPanel1}').style.display = 'none';
                                            document.getElementById('{!$Component.medPanel2}').style.display = 'block';
                                        } else {
                                            document.getElementById('{!$Component.medPanel1}').style.display = 'block';
                                            document.getElementById('{!$Component.medPanel2}').style.display = 'none';
                                        }
                                    </script>
                                </apex:column>
                                <apex:column headerClass="tableHead SeverityHead" style="vertical-align: top; padding-top: 15px;">
                                    <apex:facet name="header">Start Date</apex:facet>
                                    <apex:outputPanel rendered="{!IF(medicationWrapper.isReadOnly == true, false, true)}">
                                        <apex:inputField value="{!medicationWrapper.concomitantMedication.Start_Year__c}" style="width: 15%;"/>
                                        &nbsp;Year&nbsp;
                                        <apex:inputField value="{!medicationWrapper.concomitantMedication.Start_Month__c}" style="width: 10%;"/>
                                        &nbsp;Month&nbsp;
                                        <apex:inputField value="{!medicationWrapper.concomitantMedication.Start_Day__c}" style="width: 10%;"/>
                                        &nbsp;Day&nbsp;
                                    </apex:outputPanel>
                                    <apex:outputPanel rendered="{!medicationWrapper.isReadOnly}">
                                        <apex:outputField value="{!medicationWrapper.concomitantMedication.Start_Year__c}" style="width: 10%;"/>
                                        -
                                        <apex:outputField value="{!medicationWrapper.concomitantMedication.Start_Month__c}" style="width: 10%;"/>
                                        -
                                        <apex:outputField value="{!medicationWrapper.concomitantMedication.Start_Day__c}" style="width: 10%;"/>
                                        
                                    </apex:outputPanel>
                                </apex:column>
                                <apex:column headerClass="tableHead SeverityHead" style="vertical-align: top; padding-top: 15px;">
                                    <apex:facet name="header">End Date</apex:facet> 
                                    <apex:outputPanel rendered="{!IF(medicationWrapper.isReadOnly == true, false, true)}">
                                        <apex:inputField value="{!medicationWrapper.concomitantMedication.End_Year__c}" style="width: 15%;"/>
                                        &nbsp;Year&nbsp;
                                        <apex:inputField value="{!medicationWrapper.concomitantMedication.End_Month__c}" style="width: 10%;"/>
                                        &nbsp;Month&nbsp;
                                        <apex:inputField value="{!medicationWrapper.concomitantMedication.End_Day__c}" style="width: 10%;"/>
                                        &nbsp;Day&nbsp;
                                    </apex:outputPanel>
                                    <apex:outputPanel rendered="{!medicationWrapper.isReadOnly}">
                                        <apex:outputField value="{!medicationWrapper.concomitantMedication.End_Year__c}" style="width: 10%;"/>
                                        -
                                        <apex:outputField value="{!medicationWrapper.concomitantMedication.End_Month__c}" style="width: 10%;"/>
                                        -
                                        <apex:outputField value="{!medicationWrapper.concomitantMedication.End_Day__c}" style="width: 10%;"/>
                                        
                                    </apex:outputPanel>
                                </apex:column>
                                <apex:column headerClass="tableHead SeverityHead" style="vertical-align: top; padding-top: 15px;">
                                    <apex:facet name="header">Dose</apex:facet> 
                                    <apex:inputField value="{!medicationWrapper.concomitantMedication.DoseValue__c}" rendered="{!IF(medicationWrapper.isReadOnly == true, false, true)}"/>
                                    <apex:outputField value="{!medicationWrapper.concomitantMedication.DoseValue__c}" rendered="{!medicationWrapper.isReadOnly}"/>
                                </apex:column>
                                <apex:column headerClass="tableHead SeverityHead" style="vertical-align: top; padding-top: 15px;">
                                    <apex:facet name="header">Unit</apex:facet> 
                                    <apex:inputField value="{!medicationWrapper.concomitantMedication.Dose__c}" rendered="{!IF(medicationWrapper.isReadOnly == true, false, true)}"/>
                                    <apex:outputField value="{!medicationWrapper.concomitantMedication.Dose__c}" rendered="{!medicationWrapper.isReadOnly}"/>
                                </apex:column>
                                <apex:column headerClass="tableHead SeverityHead" style="vertical-align: top; padding-top: 15px;">
                                    <apex:facet name="header">Route</apex:facet> 
                                    <apex:inputField value="{!medicationWrapper.concomitantMedication.Route__c}" rendered="{!IF(medicationWrapper.isReadOnly == true, false, true)}"/>
                                    <apex:outputField value="{!medicationWrapper.concomitantMedication.Route__c}" rendered="{!medicationWrapper.isReadOnly}"/>
                                </apex:column>
                                <apex:column headerClass="tableHead SeverityHead" style="vertical-align: top; padding-top: 15px;">
                                    <apex:facet name="header">Frequency</apex:facet> 
                                    <apex:inputField value="{!medicationWrapper.concomitantMedication.Frequency__c}" rendered="{!IF(medicationWrapper.isReadOnly == true, false, true)}"/>
                                    <apex:outputField value="{!medicationWrapper.concomitantMedication.Frequency__c}" rendered="{!medicationWrapper.isReadOnly}"/>
                                </apex:column>
                            </apex:pageBlockTable>
                            <apex:outputPanel >
                                <apex:commandButton action="{!addMedication}" value="Add Medication" reRender="medicationSection" status="processingStatus"/>
                                <apex:commandButton action="{!saveMedication}" value=" Save " reRender="medicationSection" status="savingStatus" />
                                <apex:actionStatus startText="Saving...." id="savingStatus" />
                                <apex:actionStatus startText="Processing...." id="processingStatus" />
                            </apex:outputPanel>
                        </apex:actionRegion>
                    </apex:pageBlockSection> 
                </apex:pageBlock>
            </apex:tab>
            <apex:tab label="Comments & Attachments" name="attachmentTab" id="attachmentTabId" ontabenter="enterToNextTab('attachmentTab');" rendered="{!isComplete}">
                <apex:pageBlock title="Comments & Attachments" tabStyle="Account">
                    <apex:pageBlockButtons location="top">
<!--                        <apex:commandButton action="{!cancelCRF}" value="  Cancel  " onClick="return cancelConfirm();" immediate="true"/>-->
                        <apex:commandButton action="{!previous}" value=" Previous " reRender="theTabPanel,errMsg" status="splashStatus"/> 
                        <apex:commandButton action="{!next}" value="  Next  " reRender="theTabPanel,errMsg" status="splashStatus">
                            <apex:param name="nextTab" value="completeTab"/>
                        </apex:commandButton>
                        <apex:actionStatus id="tabChangeStatus" startText="Processing..."/>
                    </apex:pageBlockButtons>
                    <apex:pageMessage summary="Please redact all PHI information from attachments." severity="info" strength="3"/>
                    <apex:pageBlockSection columns="1">
<!--                        <chatter:feedWithFollowers entityId="{!chemoTreatmentWrapper.chemoTreatment.Id}" />-->
                        <apex:iframe src="/apex/ChatterPage?recId={!chemoTreatmentWrapper.chemoTreatment.Id}" scrolling="true" id="theIframe"/>
                        <CRFAttachmentComponent rId="{!chemoTreatmentWrapper.chemoTreatment.Id}" feedCRFName="Chemo_Treatment__Feed" rtId="{!chemoTreatmentWrapper.chemoTreatment.Root_CRF_Id__c}"/>
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </apex:tab>
            <apex:tab label="Complete" name="completeTab" id="completeTabId" ontabenter="enterToNextTab('completeTab');">
                <apex:pageBlock title="Chemo Treatment Form" id="pageBlockId3" tabStyle="Account">
                    <apex:pageBlockButtons location="top" >
<!--                      <apex:commandButton action="{!cancelCRF}" value="Delete" onClick="return cancelConfirm();" immediate="true" rendered="{!profileName =='System Administrator'}"/>-->
                        <apex:commandButton action="{!previous}" value=" Previous " reRender="theTabPanel, pageBlockId, pageBlockId1, pageBlockId2, pageBlockId3" status="splashStatus" rendered="{!isComplete}"/>&nbsp;&nbsp; 
                        <apex:actionStatus id="tabChangeStatus" startText="Processing..."/>
                    </apex:pageBlockButtons> 
                    <!--<apex:actionFunction name="editCRF" action="{!editCRF}" rerender="theTabPanel" status="processStatus"/> 
                    <apex:outputPanel id="dummayPanel">
                        <script>
                            //alert("{!openInEditMode}");
                            if("{!openInEditMode}" == "true") {
                                editCRF();
                            } 
                        </script>
                    </apex:outputPanel>-->
                    <apex:outputPanel rendered="{!IF($Profile.Name == 'Custom Read Only User' || $Profile.Name == 'Trial Administrator', false, true)}">
                       <apex:pageBlock tabStyle="Account">
                            <apex:pageBlockButtons location="top">
                                <apex:commandButton action="{!editCRF}" rendered="{!IF(AND(chemoTreatmentWrapper.chemoTreatment.Status__c == 'Rejected', isShowEditButton),true,false)}" value="Edit" reRender="formId" status="processStatus" />
                                <apex:actionStatus id="processStatus" startText="Processing..."/>
                            </apex:pageBlockButtons>
                        </apex:pageBlock>
                    </apex:outputPanel>
                    <apex:outputPanel ><b>Chemotherapy</b></apex:outputPanel>
                    <table>
                        <tr>
                            <td>Therapy Date</td>
                            <td>
                                <apex:outputPanel >
                                    <apex:outputText value="{0,date,MM'/'dd'/'yyyy}">
                                         <apex:param value="{!chemoTreatmentWrapper.chemoTreatment.Date_of_therapy__c}"/>
                                    </apex:outputText>
                                </apex:outputPanel>
                            </td>
                        </tr>
                        <tr>
                            <td>Patient's weight</td>
                            <td>
                                <apex:outputPanel >
                                    <apex:outputLabel value="{!chemoTreatmentWrapper.chemoTreatment.Patient_weight__c}" />&nbsp;kg
                                </apex:outputPanel>
                            </td>
                        </tr>
                        <tr>
                            <td>Patient's height</td>
                            <td>
                                <apex:outputPanel >
                                    <apex:outputLabel value="{!chemoTreatmentWrapper.chemoTreatment.Patient_height__c}" />&nbsp;cm
                                </apex:outputPanel>
                            </td>
                        </tr>
                        <tr>
                            <td>Randomization assignment</td>
                            <td>
                                <apex:outputPanel >
                                    <apex:outputLabel value="{!treatmentArm}" />
                                </apex:outputPanel>
                            </td>
                        </tr>
                        <tr>
                            <td>Did patient go off study treatment?</td>
                            <td>
                                <apex:outputPanel >
                                    <apex:outputLabel value="{!chemoTreatmentWrapper.chemoTreatment.Did_patient_go_off_study_treatment__c}" />
                                </apex:outputPanel>
                            </td>
                        </tr>
                        <tr>
                            <td>Cycle number</td>
                            <td>
                                <apex:outputText value="{0, number, integer}">
                                <apex:param value="{!chemoTreatmentWrapper.chemoTreatment.Cycle_number__c}" />
                            </apex:outputText>
                            </td>
                        </tr>
                    </table>
                    <br />
                    <apex:outputPanel id="chemoTherapySecId" >
                        <b><font size="3">Chemo Therapy Agents</font></b>
                    </apex:outputPanel>
                    <br />
                    <br />
                    <apex:pageBlockTable value="{!lstCTWrapper}" var="ctWrapper" id="tableId1">
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Agent(s)</apex:facet>
                            <apex:outputText value="{!ctWrapper.chemoTherapy.Dose_Mod__c}"/>
                            <apex:outputText value="{!ctWrapper.agentName}" rendered="{!IF(ctWrapper.chemoTherapy.Other_Agent__c == null, true, false)}"/>
                            <apex:outputText value="{!ctWrapper.chemoTherapy.Other_Agent__c}" rendered="{!IF(ctWrapper.chemoTherapy.Other_Agent__c == null, false, true)}"/>
                        </apex:column>
                        <!--<apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Cycle Number</apex:facet>
                            <apex:outputText value="{0, number, integer}">
                                <apex:param value="{!chemoTreatmentWrapper.chemoTreatment.Cycle_number__c}" />
                            </apex:outputText>
                        </apex:column>
                        --><apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Day Number</apex:facet>
                            <apex:outputText value="{0, number, integer}">
                                <apex:param value="{!ctWrapper.chemoTherapy.Day__c}" />
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Prescribed Dose</apex:facet>
                            <apex:outputText value="{!ctWrapper.chemoTherapy.Prescribed_Dose__c}" />&nbsp;
                            {!ctWrapper.doseUnit}
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Total Dose Administered</apex:facet>
                            <apex:outputText value="{!ctWrapper.chemoTherapy.Total_Dose__c}" />&nbsp;
                            {!ctWrapper.totalDoseUnit}
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Dose Delay?</apex:facet>
                            <apex:outputText value="{!ctWrapper.chemoTherapy.Dose_Delay__c}" />
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Dose Mod</apex:facet>
                            <apex:outputText value="{!ctWrapper.chemoTherapy.Dose_Mod__c}" rendered="{!IF(ctWrapper.isOtherAgent, false, true)}" />
                            <apex:outputText value="{!IF(ctWrapper.chemoTherapy.Dose_Mod__c != null, '%', '')}" rendered="{!IF(ctWrapper.isOtherAgent, false, true)}" />
                            <apex:outputText value="---" rendered="{!ctWrapper.isOtherAgent}" />
                            
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Dose Mod Reason</apex:facet>
                            <apex:outputText value="{!ctWrapper.chemoTherapy.Dose_modification__c}" rendered="{!IF(ctWrapper.isOtherAgent, false, true)}"/>
                            <apex:outputText value="---" rendered="{!ctWrapper.isOtherAgent}" />
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Did patient stop receiving?</apex:facet>
                            <apex:outputText value="{!IF(ctWrapper.chemoTherapy.Did_patient_stop_receiving__c, 'Yes', 'No')}" rendered="{!IF(ctWrapper.isOtherAgent, false, true)}"/>
                            <apex:outputText value="---" rendered="{!ctWrapper.isOtherAgent}" />
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Reason why patient stopped receiving</apex:facet>
                            <apex:outputText rendered="{!IF(ctWrapper.isOtherAgent, false, true)}" value="{!ctWrapper.chemoTherapy.Reason_why_patient_stopped_receiving__c}" />
                            <apex:outputText rendered="{!IF(ctWrapper.isOtherAgent, false, true)}" value="{!IF(ctWrapper.chemoTherapy.Other_Reason_Patient_Stop_Receiving__c != null, '-'+ctWrapper.chemoTherapy.Other_Reason_Patient_Stop_Receiving__c, '')}" />
                            <apex:outputText value="---" rendered="{!ctWrapper.isOtherAgent}" />
                        </apex:column>
                    </apex:pageBlockTable>
                    <br />
                    <apex:outputPanel id="growthSectorSecId" >
                        <b><font size="3">Growth Factors (for this cycle)</font></b>
                    </apex:outputPanel>
                    <br />
                    <br />
                    <apex:pageBlockTable value="{!lstGrowthFactor}" var="gf" id="tableId2">
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Drug Name</apex:facet>
                            <apex:outputText value="{!gf.Name}" />
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Prescribed Dose</apex:facet>
                            <apex:outputText value="{!gf.Dose__c}" />&nbsp;<apex:outputLabel value="{!IF(gf.Name == 'Neupogen', 'mcg', 'mg')}" />
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Total Dose Administered</apex:facet>
                            <apex:outputText value="{!gf.TotalDose__c}" />&nbsp;mg
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Route</apex:facet>
                            <apex:outputText value="{!gf.Route__c}" />
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Notes</apex:facet>
                            <apex:outputText value="{!gf.Notes__c}" />
                        </apex:column>
                    </apex:pageBlockTable>
                    <br />
                    <apex:outputPanel id="medicationSecId" >
                        <b><font size="3">Concomitant Medications</font></b>
                    </apex:outputPanel>
                    <br />
                    <br />
                    <apex:pageBlockTable value="{!chemoTreatmentWrapper.lstMedicationWrapper}" var="mediWrapper" id="tableId3">
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Medications</apex:facet>
                                <apex:outputPanel id="medPanel1">
                                    <apex:outputText value="{!mediWrapper.concomitantMedication.Medication__r.Name}" rendered="{!mediWrapper.isReadOnly}" id="readMedicationId"/>
                                </apex:outputPanel>
                                
                                <apex:outputPanel id="medPanel2" style="display: none;">
                                    <apex:outputField value="{!mediWrapper.concomitantMedication.Other_Madication__c}" rendered="{!mediWrapper.isReadOnly}" id="readOtherMedId"/>
                                </apex:outputPanel>
                                
                                <script>
                                    if('{!mediWrapper.isOtherMedication}' == 'true') {
                                        document.getElementById('{!$Component.medPanel1}').style.display = 'none';
                                        document.getElementById('{!$Component.medPanel2}').style.display = 'block';
                                    } else {
                                        document.getElementById('{!$Component.medPanel1}').style.display = 'block';
                                        document.getElementById('{!$Component.medPanel2}').style.display = 'none';
                                    }
                                </script>
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Start Date</apex:facet>
                            <apex:outputText value="{!mediWrapper.concomitantMedication.Start_Month__c}" />/
                            <apex:outputText value="{!mediWrapper.concomitantMedication.Start_Day__c}" />/
                            <apex:outputText value="{!mediWrapper.concomitantMedication.Start_Year__c}" />
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">End Date</apex:facet>
                            <apex:outputText value="{!mediWrapper.concomitantMedication.End_Month__c}" />/
                            <apex:outputText value="{!mediWrapper.concomitantMedication.End_Day__c}" />/
                            <apex:outputText value="{!mediWrapper.concomitantMedication.End_Year__c}" />
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Dose</apex:facet>
                            <apex:outputText value="{!mediWrapper.concomitantMedication.DoseValue__c}" />
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Unit</apex:facet>
                            <apex:outputText value="{!mediWrapper.concomitantMedication.Dose__c}" />
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Route</apex:facet>
                            <apex:outputText value="{!mediWrapper.concomitantMedication.Route__c}" />
                        </apex:column>
                        <apex:column headerClass="tableHead" width="7%" >
                            <apex:facet name="header">Frequency</apex:facet>
                            <apex:outputText value="{!mediWrapper.concomitantMedication.Frequency__c}" />
                        </apex:column>
                    </apex:pageBlockTable>
                    <br />
                    <apex:pageBlockSection columns="1" rendered="{!NOT(ISNULL(chemoTreatmentWrapper.chemoTreatment.Id))}">
                        <c:CRFAttachmentComponent rId="{!chemoTreatmentWrapper.chemoTreatment.Id}" feedCRFName="Chemo_Treatment__Feed" rtId="{!chemoTreatmentWrapper.chemoTreatment.Root_CRF_Id__c}"/>
                    </apex:pageBlockSection>
                    
                    <apex:pageBlockSection title="CRF Events" columns="1" rendered="{!NOT(ISNULL(chemoTreatmentWrapper.chemoTreatment.Id))}">
                        <c:CRFEventComponent rId="{!chemoTreatmentWrapper.chemoTreatment.Id}" objectName="Chemo_Treatment__c" rtId="{!chemoTreatmentWrapper.chemoTreatment.Root_CRF_Id__c}"/>
                    </apex:pageBlockSection>
                </apex:pageBlock>
                <div align="center">
<!--                    <apex:commandButton action="{!cancelCRF}" value="  Cancel  " onClick="return cancelConfirm();" immediate="true" rendered="{!isComplete}"/>&nbsp;&nbsp;-->
                </div>
                <apex:outputPanel id="msgPanelId" layout="block" style="width: 100%;">
                        <table width="100%">
                            <tr>
                                <td colspan="2" width="100%" align="center">
                                    <br /> 
                                    <font color="{!msgColor}">{!errorMsg}&nbsp;</font>
                                    <br />
                                </td>
                            </tr>
                            <tr>
                                <td width="30%">&nbsp;</td>
                                <td width="70%">
                                    <apex:outputLabel value="User Id :" style="font-weight: bold;" rendered="{!isComplete}"/>&nbsp;&nbsp;<apex:outputLabel value="{!$User.Username}" rendered="{!isComplete}"/>&nbsp;&nbsp;&nbsp;&nbsp;
                                    <apex:outputLabel value="Secure Code: "  style="font-weight: bold;" rendered="{!isComplete}"/>&nbsp;&nbsp;<apex:inputSecret value="{!password}" rendered="{!isComplete}"/>&nbsp;&nbsp;
                                    <apex:commandButton value="  Sign and Submit  " action="{!signAndSubmit}" rendered="{!isComplete}"/>
                                    <apex:commandButton value="Resend Security Code" action="{!resendCode}" rerender="msgPanelId" status="counterStatus" rendered="{!isComplete}"/>
                                    <apex:actionStatus id="counterStatus" startText="Processing..." onstop=""/>
                                </td>
                            </tr>
                        </table>
                </apex:outputPanel> 
            </apex:tab>
            
            <!--<script>enableAgents(document.getElementById('pageId:formId:chemoAdminId:studyTreatmentId'));</script>
        --></apex:tabPanel>
        
    </apex:form>
</apex:page>